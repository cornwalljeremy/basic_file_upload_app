{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Penny/New%20Coding/Basic%20file%20upload%20app/app/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { \n  S3Client, \n  ListObjectsV2Command, \n  PutObjectCommand, \n  HeadObjectCommand,\n  DeleteObjectCommand,\n  CopyObjectCommand, \n} from \"@aws-sdk/client-s3\";\nimport { revalidatePath } from \"next/cache\";\n\n// Initialize the S3 Client\nconst s3Client = new S3Client({\n  region: process.env.AWS_REGION || \"us-east-2\",\n  credentials: {\n    accessKeyId: process.env.AWS_ACCESS_KEY_ID!,\n    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,\n  },\n});\n\n/**\n * Fetches the list of files currently in the S3 bucket\n */\nexport async function getS3Files() {\n  console.log(\"DEBUG - Region:\", process.env.AWS_REGION);\n  console.log(\"DEBUG - Bucket:\", process.env.AWS_BUCKET_NAME);\n\n  try {\n    const { Contents } = await s3Client.send(\n      new ListObjectsV2Command({\n        Bucket: process.env.AWS_BUCKET_NAME!,\n      })\n    );\n\n    return (\n      Contents?.map((file) => ({\n        key: file.Key,\n        size: file.Size,\n        lastModified: file.LastModified,\n      })) || []\n    );\n  } catch (error) {\n    console.error(\"AWS List Error:\", error);\n    return [];\n  }\n}\n\n/**\n * Uploads a file to S3 with automatic (n) renaming if the name exists\n */\nexport async function uploadFile(formData: FormData) {\n  try {\n    const file = formData.get(\"file\") as File;\n    if (!file) throw new Error(\"No file provided\");\n\n    const arrayBuffer = await file.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n\n    let fileName = file.name;\n    let fileExists = true;\n    let counter = 1;\n\n    // --- CHECK FOR DUPLICATES LOOP ---\n    while (fileExists) {\n      try {\n        await s3Client.send(\n          new HeadObjectCommand({\n            Bucket: process.env.AWS_BUCKET_NAME!,\n            Key: fileName,\n          })\n        );\n        \n        // If HeadObject succeeds, the file exists. Rename and try again.\n        const lastDot = file.name.lastIndexOf(\".\");\n        const baseName = lastDot !== -1 ? file.name.substring(0, lastDot) : file.name;\n        const extension = lastDot !== -1 ? file.name.substring(lastDot) : \"\";\n        \n        fileName = `${baseName}(${counter})${extension}`;\n        counter++;\n      } catch (error: any) {\n        // S3 returns \"NotFound\" (404) if the key is available\n        if (error.name === \"NotFound\" || error.$metadata?.httpStatusCode === 404) {\n          fileExists = false;\n        } else {\n          throw error;\n        }\n      }\n    }\n\n    // --- UPLOAD FINAL FILENAME ---\n    await s3Client.send(\n      new PutObjectCommand({\n        Bucket: process.env.AWS_BUCKET_NAME!,\n        Key: fileName,\n        Body: buffer,\n        ContentType: file.type,\n      })\n    );\n\n    revalidatePath(\"/\"); // Refresh the UI list\n    return { success: true, fileName };\n  } catch (error) {\n    console.error(\"Upload Error:\", error);\n    throw new Error(\"Failed to upload file\");\n  }\n}\n\n/**\n * Deletes a file from S3\n */\nexport async function deleteFile(key: string) {\n  try {\n    await s3Client.send(\n      new DeleteObjectCommand({\n        Bucket: process.env.AWS_BUCKET_NAME!,\n        Key: key,\n      })\n    );\n    revalidatePath(\"/\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"Delete Error:\", error);\n    throw new Error(\"Failed to delete file\");\n  }\n}\n export async function renameS3File(oldKey: string, newKey: string) {\n  try {\n    const bucket = process.env.AWS_BUCKET_NAME!;\n\n    // 1. Copy the object to the new name\n    await s3Client.send(\n      new CopyObjectCommand({\n        Bucket: bucket,\n        CopySource: `${bucket}/${oldKey}`,\n        Key: newKey,\n      })\n    );\n\n    // 2. Delete the old object\n    await s3Client.send(\n      new DeleteObjectCommand({\n        Bucket: bucket,\n        Key: oldKey,\n      })\n    );\n\n    revalidatePath(\"/\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"Rename Error:\", error);\n    throw new Error(\"Failed to rename file\");\n  }\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Penny/New%20Coding/Basic%20file%20upload%20app/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getS3Files as '00a0f2e7b00dfffdcf85368f8adab9714d4a203dac'} from 'ACTIONS_MODULE0'\nexport {renameS3File as '609bd0ab5a8fb4439a00319427145cb77031f5f7bb'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}