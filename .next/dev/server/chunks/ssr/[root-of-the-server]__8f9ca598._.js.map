{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Penny/New%20Coding/Basic%20file%20upload%20app/app/actions.ts"],"sourcesContent":["\"use strict\";\n\nimport { \n  S3Client, \n  ListObjectsV2Command, \n  PutObjectCommand, \n  HeadObjectCommand,\n  DeleteObjectCommand \n} from \"@aws-sdk/client-s3\";\nimport { revalidatePath } from \"next/cache\";\n\n// Initialize the S3 Client\nconst s3Client = new S3Client({\n  region: process.env.AWS_REGION || \"us-east-2\",\n  credentials: {\n    accessKeyId: process.env.AWS_ACCESS_KEY_ID!,\n    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,\n  },\n});\n\n/**\n * Fetches the list of files currently in the S3 bucket\n */\nexport async function getS3Files() {\n  console.log(\"DEBUG - Region:\", process.env.AWS_REGION);\n  console.log(\"DEBUG - Bucket:\", process.env.AWS_BUCKET_NAME);\n\n  try {\n    const { Contents } = await s3Client.send(\n      new ListObjectsV2Command({\n        Bucket: process.env.AWS_BUCKET_NAME!,\n      })\n    );\n\n    return (\n      Contents?.map((file) => ({\n        key: file.Key,\n        size: file.Size,\n        lastModified: file.LastModified,\n      })) || []\n    );\n  } catch (error) {\n    console.error(\"AWS List Error:\", error);\n    return [];\n  }\n}\n\n/**\n * Uploads a file to S3 with automatic (n) renaming if the name exists\n */\nexport async function uploadFile(formData: FormData) {\n  try {\n    const file = formData.get(\"file\") as File;\n    if (!file) throw new Error(\"No file provided\");\n\n    const arrayBuffer = await file.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n\n    let fileName = file.name;\n    let fileExists = true;\n    let counter = 1;\n\n    // --- CHECK FOR DUPLICATES LOOP ---\n    while (fileExists) {\n      try {\n        await s3Client.send(\n          new HeadObjectCommand({\n            Bucket: process.env.AWS_BUCKET_NAME!,\n            Key: fileName,\n          })\n        );\n        \n        // If HeadObject succeeds, the file exists. Rename and try again.\n        const lastDot = file.name.lastIndexOf(\".\");\n        const baseName = lastDot !== -1 ? file.name.substring(0, lastDot) : file.name;\n        const extension = lastDot !== -1 ? file.name.substring(lastDot) : \"\";\n        \n        fileName = `${baseName}(${counter})${extension}`;\n        counter++;\n      } catch (error: any) {\n        // S3 returns \"NotFound\" (404) if the key is available\n        if (error.name === \"NotFound\" || error.$metadata?.httpStatusCode === 404) {\n          fileExists = false;\n        } else {\n          throw error;\n        }\n      }\n    }\n\n    // --- UPLOAD FINAL FILENAME ---\n    await s3Client.send(\n      new PutObjectCommand({\n        Bucket: process.env.AWS_BUCKET_NAME!,\n        Key: fileName,\n        Body: buffer,\n        ContentType: file.type,\n      })\n    );\n\n    revalidatePath(\"/\"); // Refresh the UI list\n    return { success: true, fileName };\n  } catch (error) {\n    console.error(\"Upload Error:\", error);\n    throw new Error(\"Failed to upload file\");\n  }\n}\n\n/**\n * Deletes a file from S3\n */\nexport async function deleteFile(key: string) {\n  try {\n    await s3Client.send(\n      new DeleteObjectCommand({\n        Bucket: process.env.AWS_BUCKET_NAME!,\n        Key: key,\n      })\n    );\n    revalidatePath(\"/\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"Delete Error:\", error);\n    throw new Error(\"Failed to delete file\");\n  }\n}"],"names":[],"mappings":";;;;;;;;AAEA;AAOA;AATA;;;AAWA,2BAA2B;AAC3B,MAAM,WAAW,IAAI,gOAAQ,CAAC;IAC5B,QAAQ,QAAQ,GAAG,CAAC,UAAU,IAAI;IAClC,aAAa;QACX,aAAa,QAAQ,GAAG,CAAC,iBAAiB;QAC1C,iBAAiB,QAAQ,GAAG,CAAC,qBAAqB;IACpD;AACF;AAKO,eAAe;IACpB,QAAQ,GAAG,CAAC,mBAAmB,QAAQ,GAAG,CAAC,UAAU;IACrD,QAAQ,GAAG,CAAC,mBAAmB,QAAQ,GAAG,CAAC,eAAe;IAE1D,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,SAAS,IAAI,CACtC,IAAI,4OAAoB,CAAC;YACvB,QAAQ,QAAQ,GAAG,CAAC,eAAe;QACrC;QAGF,OACE,UAAU,IAAI,CAAC,OAAS,CAAC;gBACvB,KAAK,KAAK,GAAG;gBACb,MAAM,KAAK,IAAI;gBACf,cAAc,KAAK,YAAY;YACjC,CAAC,MAAM,EAAE;IAEb,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,EAAE;IACX;AACF;AAKO,eAAe,WAAW,QAAkB;IACjD,IAAI;QACF,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAE3B,MAAM,cAAc,MAAM,KAAK,WAAW;QAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,IAAI,WAAW,KAAK,IAAI;QACxB,IAAI,aAAa;QACjB,IAAI,UAAU;QAEd,oCAAoC;QACpC,MAAO,WAAY;YACjB,IAAI;gBACF,MAAM,SAAS,IAAI,CACjB,IAAI,yOAAiB,CAAC;oBACpB,QAAQ,QAAQ,GAAG,CAAC,eAAe;oBACnC,KAAK;gBACP;gBAGF,iEAAiE;gBACjE,MAAM,UAAU,KAAK,IAAI,CAAC,WAAW,CAAC;gBACtC,MAAM,WAAW,YAAY,CAAC,IAAI,KAAK,IAAI,CAAC,SAAS,CAAC,GAAG,WAAW,KAAK,IAAI;gBAC7E,MAAM,YAAY,YAAY,CAAC,IAAI,KAAK,IAAI,CAAC,SAAS,CAAC,WAAW;gBAElE,WAAW,GAAG,SAAS,CAAC,EAAE,QAAQ,CAAC,EAAE,WAAW;gBAChD;YACF,EAAE,OAAO,OAAY;gBACnB,sDAAsD;gBACtD,IAAI,MAAM,IAAI,KAAK,cAAc,MAAM,SAAS,EAAE,mBAAmB,KAAK;oBACxE,aAAa;gBACf,OAAO;oBACL,MAAM;gBACR;YACF;QACF;QAEA,gCAAgC;QAChC,MAAM,SAAS,IAAI,CACjB,IAAI,wOAAgB,CAAC;YACnB,QAAQ,QAAQ,GAAG,CAAC,eAAe;YACnC,KAAK;YACL,MAAM;YACN,aAAa,KAAK,IAAI;QACxB;QAGF,IAAA,+IAAc,EAAC,MAAM,sBAAsB;QAC3C,OAAO;YAAE,SAAS;YAAM;QAAS;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,WAAW,GAAW;IAC1C,IAAI;QACF,MAAM,SAAS,IAAI,CACjB,IAAI,2OAAmB,CAAC;YACtB,QAAQ,QAAQ,GAAG,CAAC,eAAe;YACnC,KAAK;QACP;QAEF,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Penny/New%20Coding/Basic%20file%20upload%20app/app/page.tsx"],"sourcesContent":["\"use client\";\nimport { useRef, useState, useEffect, useCallback } from \"react\";\n// Added renameS3File to the imports\nimport { getS3Files, getDownloadUrl, deleteS3File, renameS3File } from \"./actions\";\n\ninterface S3File {\n  key: string;\n  size: number;\n}\n\nexport default function Home() {\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [file, setFile] = useState<File | null>(null);\n  const [files, setFiles] = useState<S3File[]>([]);\n  const [status, setStatus] = useState(\"\");\n  const [uploading, setUploading] = useState(false);\n\n  // 1. PURE DATA FUNCTION\n  const loadFileData = useCallback(async () => {\n    try {\n      const data = await getS3Files();\n      return (data || []).map((f) => ({\n        key: (f as { key: string }).key || \"unknown\",\n        size: (f as { size: number }).size || 0,\n      }));\n    } catch (error) {\n      console.error(\"Data loading error:\", error);\n      return [];\n    }\n  }, []);\n\n  // 2. THE EFFECT\n  useEffect(() => {\n    let isMounted = true;\n    loadFileData().then((formattedFiles) => {\n      if (isMounted) {\n        setFiles(formattedFiles);\n      }\n    });\n    return () => { isMounted = false; };\n  }, [loadFileData]);\n\n  // 3. REFRESH HELPER\n  const refreshList = async () => {\n    const data = await loadFileData();\n    setFiles(data);\n  };\n\n  async function uploadFile() {\n    if (!file) return;\n    setUploading(true);\n    setStatus(\"Uploading...\");\n    \n    const formData = new FormData();\n    formData.append(\"file\", file);\n\n    const res = await fetch(\"/api/upload\", {\n      method: \"POST\",\n      body: formData,\n    });\n\n    setUploading(false);\n    if (res.ok) {\n      setStatus(\"Upload successful ✅\");\n      setFile(null);\n      await refreshList();\n    } else {\n      setStatus(\"Upload failed ❌\");\n    }\n  }\n\n  function openFilePicker() {\n    fileInputRef.current?.click();\n  }\n\n  return (\n    <main style={{ padding: 40, maxWidth: 800, fontFamily: \"sans-serif\" }}>\n      <h1>S3 Storage Manager</h1>\n\n      <div style={{ marginBottom: 20 }}>\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          hidden\n          onChange={(e) => setFile(e.target.files?.[0] || null)}\n        />\n        <button onClick={openFilePicker}>Select File</button>\n        <button\n          onClick={uploadFile}\n          disabled={!file || uploading}\n          style={{ marginLeft: 10 }}\n        >\n          {uploading ? \"Uploading...\" : \"Upload to S3\"}\n        </button>\n        {file && <span style={{ marginLeft: 15 }}>Selected: {file.name}</span>}\n      </div>\n\n      <p>{status}</p>\n      <hr />\n\n      <section style={{ marginTop: 30 }}>\n        <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n          <h3>Your Bucket Files</h3>\n          <button onClick={refreshList}>Refresh List</button>\n        </div>\n        \n        <ul style={{ marginTop: 20, listStyle: \"none\", padding: 0 }}>\n          {files.length === 0 ? (\n            <li>No files found.</li>\n          ) : (\n            files.map((f) => (\n              <li key={f.key} style={{ padding: \"12px 0\", borderBottom: \"1px solid #eee\", display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n                <span style={{ flex: 1, marginRight: \"20px\" }}>\n                  <strong>{f.key}</strong> — {(f.size / 1024).toFixed(2)} KB\n                </span>\n                \n                <div style={{ display: \"flex\", gap: \"10px\" }}>\n                  <button \n                    onClick={async () => {\n                      const url = await getDownloadUrl(f.key);\n                      window.open(url, \"_blank\");\n                    }}\n                    style={{ padding: \"4px 8px\", cursor: \"pointer\" }}\n                  >\n                    Download\n                  </button>\n\n                  {/* RENAME BUTTON */}\n                  <button \n                    onClick={async () => {\n                      const newName = prompt(\"Enter new filename:\", f.key);\n                      if (newName && newName !== f.key) {\n                        setStatus(\"Renaming...\");\n                        const result = await renameS3File(f.key, newName);\n                        if (result.success) {\n                          setStatus(\"Renamed successfully ✅\");\n                          await refreshList();\n                        } else {\n                          setStatus(\"Rename failed ❌\");\n                        }\n                      }\n                    }}\n                    style={{ padding: \"4px 8px\", cursor: \"pointer\", backgroundColor: \"#f0f0f0\", border: \"1px solid #ccc\", borderRadius: \"4px\" }}\n                  >\n                    Rename\n                  </button>\n\n                  <button \n                    onClick={async () => {\n                      if (confirm(`Are you sure you want to delete ${f.key}?`)) {\n                        setStatus(\"Deleting...\");\n                        const result = await deleteS3File(f.key);\n                        if (result.success) {\n                          setStatus(\"Deleted successfully ✅\");\n                          await refreshList(); \n                        } else {\n                          setStatus(\"Delete failed ❌\");\n                        }\n                      }\n                    }}\n                    style={{ \n                      padding: \"4px 8px\", \n                      cursor: \"pointer\", \n                      backgroundColor: \"#ff4444\", \n                      color: \"white\", \n                      border: \"none\", \n                      borderRadius: \"4px\" \n                    }}\n                  >\n                    Delete\n                  </button>\n                </div>\n              </li>\n            ))\n          )}\n        </ul>\n      </section>\n    </main>\n  );\n}"],"names":[],"mappings":"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"}}]
}